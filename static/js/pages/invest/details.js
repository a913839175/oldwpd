define("pages/invest/details",["jquery","tip","common","protocol","widgets/widgets","components/components","dialog","handlebars"],function(a){
	function b(a,b,c){var d=parseInt(a,10),f=0,g=0,h=0;d>60&&(f=parseInt(d/60,10),d=parseInt(d%60,10),f>60&&(g=parseInt(f/60,10),f=parseInt(f%60,10)),g>24&&(h=parseInt(g/24,10),g=parseInt(g%24,10)));var i="";i=h>0?""+parseInt(h,10)+"天"+parseInt(g,10)+"时":g>0?""+parseInt(g,10)+"时"+parseInt(f,10)+"分":parseInt(f,10)+"分"+parseInt(d,10)+"秒","#J_WAIT_BUTTON"==b?(i="",i=h>0?""+parseInt(h,10)+"天"+parseInt(g,10)+"时"+parseInt(f,10)+"分":""+parseInt(g,10)+"时"+parseInt(f,10)+"分"+parseInt(d,10)+"秒",e(b).css("letter-spacing","0"),"0"===c&&(i+="后开始预定"),"3"===c&&(i+="后开始加入")):("0"===c&&(i+="后预定"),"3"===c&&(i+="后加入")),e(b).html(i)}
	function c(a){if(e(a).length<=0||"3"!==e(a).attr("data2")&&"0"!==e(a).attr("data2")||"-1"===e(a).attr("data1"))return!1;var c=e(a).attr("data1"),d=setInterval(function(){c-=1,b(c,a,e(a).attr("data2")),0>=c&&(clearInterval(d),location.reload())},1e3)}
	function d(){var a="#J_WAIT_BUTTON";if(e(a).length<=0||"3"!==e(a).attr("data")&&"0"!==e(a).attr("data")||"-1"===e(a).attr("data1"))return!1;var c=e(a).attr("data1"),d=setInterval(function(){c-=1,b(c,"#J_WAIT_BUTTON",e("#J_WAIT_BUTTON").attr("data")),0>=c&&(clearInterval(d),location.reload())},1e3)}
	var e=a("jquery");
	e(function(){
		{var b=a("tip"),c=a("common"),d=a("protocol"),f=a("widgets/widgets"),g=a("components/components");a("dialog"),a("handlebars")}
		//var h=e("#pg-helper-success-hint").html();
		//if(h){var i=e.parseJSON(h);i&&c.showMessage2({title:"微+计划预定成功！",depositAmount:i.data.depositAmount,endPaymentTime:i.data.endPaymentTime,overplusAmount:i.data.overplusAmount,button:{link:"/account/invest!plan.action?planTab=RESERVATIONS",text:"立即支付"}})}
		var j,k=(f.GoTop(),"true"==e("#authenticated").text())
		l="true"==e("#pg-helper-is-investor").text(),
		m=e("#pg-helper-be-investor-message").html();
		//n=e("#fullTime"),o=e("#university")
		;
		//if(n.length){var p=n.data("time"),q=p.match(/(\d+)天/);q=null!==q?Number(q[1]):q,n.html(q>0?p.split("分")[0]+"分":p.split("天")[1])}
		//if(o.length){var r=o.data("data");o.html(r.length?r.length>6?r.substring(0,6)+"...":r:"--")}
		var s=e("#counter");s.length>0&&(new f.Counter({container:s,delta:parseInt(s.data("delta"),10)}).init(),e("#counter").hasClass("ui-counter-seconds")||e("#counter").parent().children(".suffix").show());
		parseFloat(e("#max-account").data("account"),10);
		if(e("#pg-helper-has-withdraw-password").length>0){var t="true"==e("#pg-helper-has-withdraw-password").text();l=t&&l}
		var u,v,w,x={container:e("#investment-terminal"),authenticated:k,qualified:l,qualifiedMessage:m};
		if(e("#pg-loan-invest").length>0)u=parseInt(e("#max-amount").data("amount"),10),
		e.extend(x,{page:"loan-invest",unit:"amount",template:e("#confirm-loan-template"),amountPerShare:"cf"==e("#loan-type").val()?1e3:100,maxAmount:u,maxShares:u/w});
		//else if(e("#pg-loan-transfer").length>0)v=parseInt(e("#max-shares").data("shares"),10),w=parseFloat(e("#amount-per-share").data("amount-per-share"),10),e.extend(x,{page:"loan-transfer",unit:"shares",template:e("#confirm-transfer-in-template"),amountPerShare:w,maxAmount:v*w,maxShares:v,utmSourceTransfer:"cf"==e("#loan-type-tr").val()?!0:!1});
		//else if(e("#pg-plan-join, #pg-plan-index").length>0){var y=e("#plan-status").text(),z=parseInt(e("#max-amount-1").data("amount"),10),A=parseInt(e("#max-amount-2").data("amount"),10);u=z>A?A:z,w=e("#share-amount").attr("data-share-amount");var B=parseFloat(e("#fee-rate").data("fee-rate"),10)/100,C=parseFloat(e("#deposit-rate").data("deposit-rate"),10)/100,D=Number(e("#J_thisMaxDepositAmount").attr("data")),E=Number(e("#J_maxDepositAmount").attr("data"));C>D?C=D:C>E&&(C=E),e.extend(x,{plan:{status:y},page:"plan-join",unit:"amount",template:e("RSV"==y?"#confirm-plan-reserve-template":"#confirm-plan-join-template"),amountPerShare:w,maxAmount:u,maxShares:u/w,fee:B,deposit:C})}
		if(new g.InvestmentTerminal(x).init(),e("#plan-basic").length>0){}
		//var J=function(a,b,c){var g=new f.List({name:a,api:b,title:!0,params:c,container:e("#"+a+"-records"),rendered:function(a){var c=a.status,f=a.data,g=d.translator;if(0===c&&b==d.API.getLoanInvestmentRecords&&e("#investor-count").text(f.lenderRecords.length),0===c&&b==d.API.getLoanLenderRecords&&e("#loan-buyer-count").text(f.lenders.length),0===c&&b==d.API.getLoanTransferRecords&&(e("#loan-done-amount").text(g._commaFloat(f.account)),e("#loan-left-amount").text(g._commaFloat(f.noAccount))),0===c&&b==d.API.getLoanCollectionRecords&&0===f.dunInfoList.length&&e("#collection-records").parent().remove(),0===c&&b==d.API.getLoanRepaymentRecords&&(e("#repayment-done-amount").text(g._commaFloat(f.repaid)),e("#repayment-left-amount").text(g._commaFloat(f.unRepaid))),0===c&&b==d.API.getPlanJoinedRecords){e("#joined-count").text(f.jsonList.length);var h=0;e.each(f.jsonList,function(a,b){h+=Number(b.amount.replace(/,/g,""))}),e("#reserve-had-pay-amount").html(h)}if(0===c&&b==d.API.getPlanReserveRecords){var i=0;e.each(f.rsvList,function(a,b){"未支付"==b.status&&(i+=b.planAmountNotComma)}),e("#reserve-not-pay-amount").html(i),e("#reserve-count").text(f.rsvList.length)}}}).init();return g._update(g.getParams()),g};
		if(e("#loan-details").length>0){
			//var K=e("#pg-helper-loan-id").text();e.each(e(".pg-helper.large-number"),function(a,b){var c=e("#"+e(b).data("name")),f=e(b).text(),g=c.children("em"),h=c.children(".prefix"),i=c.children(".suffix");if(f){var j=parseFloat(f,10),k=parseInt(100*d.translator._bankersRound(j/100),10);(k!=j||j>=1e5)&&h.text("约"),k>=1e5?(h.length>0?(k=Math.floor(k/1e4),g.text(k)):g.text(d.translator._fixedFloat2(k/1e4)),i.text("万元")):g.text(k)}else g.text("0")}),e.each(e(".maybe-empty"),function(a,b){e(b).text()||e(b).text("-")});
			//var L,M;
			//L=c.loadJSON("#comments-data",!0),
			//M=e("#comments").length?new f.List({api:d.API.getCommentsOnLoan,name:"comments",container:e("#comments"),template:e("#comments-template"),params:{loanId:K},pagination:!0}).init(L):new f.List({api:d.API.getCommentsOnLoan,name:"comment",container:e("#comments2"),template:e("#comments-template2"),params:{loanId:K},pagination:!0}).init(L);
			//var N=e("#comment-post"),O=e("#comment-content");
			//O.focus(function(){e(".comment-msg").empty()}),
			//N.click(function(){var a=O.val(),b=e(this).siblings(".comment-msg");if(!N.hasClass("disabled")){if(!l)return void c.showMessage({info:!0,title:"请完善安全设置",message:"在使用该功能前，请先完成<em>实名认证</em>和<em>交易密码</em>设置。",button:{link:"/account/info!security.action",text:"去设置"}});if(!a)return void b.text("留言内容不能为空！");if(a.length>500)return void b.text("留言字数不能超过500字！");var f={id:K,threadId:"0",comment:a};N.addClass("disabled");var g=e('<li><img src="/static/img/loading.gif" /> </li>');e("#comments").prepend(g),d.postCommentOnLoan(f,function(a,b,d){0===a?(M.add(d.comment,!0,e("#comment-template")),O.val("")):c.showMessage(b),g.remove(),N.removeClass("disabled")})}});
			//var P=e("#comment-post2"),Q=e("#comment-content2");
			//P.click(function(){var a=Q.val();if(!P.hasClass("disabled")){if(!l)return void c.showMessage({info:!0,title:"请完善安全设置",message:"在使用该功能前，请先完成<em>实名认证</em>和<em>交易密码</em>设置。",button:{link:"/account/info!security.action",text:"去设置"}});if(a){var b={id:K,threadId:"0",comment:a};N.addClass("disabled"),d.postCommentOnLoan(b,function(a,b,d){0===a?(M.add(d.comment,!0,e("#comment-template2")),Q.val("")):c.showMessage(b),P.removeClass("disabled")})}}}),
			//e(document).on("focus",".ui-reply-textarea",function(){e(".msg").empty()}),
			//e(document).on("click",".ui-comments-reply",function(){if(!l)return void c.showMessage({info:!0,title:"请完善安全设置",message:"在使用该功能前，请先完成<em>实名认证</em>和<em>交易密码</em>设置。",button:{link:"/account/info!security.action",text:"去设置"}});var a=e(this).data("commentid");e(this).hide().siblings(".ui-comments-cancel").show(),$form=e(this).parents(".comments-message-info").find("form").show(),$form.find(".replaybt").unbind().on("click",function(b){var f=e(this),g=e.trim($form.find("textarea").val());if(b.preventDefault(),!g)return void f.siblings(".msg").html("回复不能为空！");if(g.length>500)return void f.siblings(".msg").html("回复字数不能超过500字！");f.attr("disabled","disabled");var h={id:K,threadId:a,comment:g},i=e('<li><img src="/static/img/loading.gif" /> </li>'),j=$form.parents(".comments-message-info").find("dl").prepend(i);d.postCommentOnLoan(h,function(a,b,d){if(0===a){var g=c.fillTemplate({data:d.comment,template:e("#replay-template")});j.prepend(g)}else c.showMessage(b);i.remove(),e(".ui-reply-textarea").val(""),f.removeAttr("disabled").siblings(".msg").empty(),$form.hide().parent().find(".ui-comments-cancel").hide().end().find(".ui-comments-reply").show()})})}),
			//e(document).on("click",".ui-comments-cancel",function(){e(this).hide().siblings(".ui-comments-reply").show().parent().siblings("form").hide()}),
			new f.Tab({name:"loan",switched:function(a,b,c){return c?!0:("investment"==b,"repayment"==b&&(J("repayment",d.API.getLoanRepaymentRecords,{loanId:K}),J("collection",d.API.getLoanCollectionRecords,{loanId:K})),"transferred"==b&&J("lender",d.API.getLoanLenderRecords,{loanId:K}),"transfer"==b&&J("transferred",d.API.getLoanTransferRecords,{loanId:K}),!0)}}).init()
			//new f.Tab({name:"loan",switched:function(a,b,c){return c?!0:("investment2"==b,"repayment2"==b&&(J("repayment2",d.API.getLoanRepaymentRecords,{loanId:K}),J("collection2",d.API.getLoanCollectionRecords,{loanId:K})),"transferred2"==b&&(J("lender2",d.API.getLoanLenderRecords,{loanId:K}),J("transferred2",d.API.getLoanTransferRecords,{loanId:K}),e(".transfer-info-switch").click(function(){e(this).children("span").toggle(),e(".summary-lenders, .summary-transrec").toggle(),e("#lender2-records, #transferred2-records").toggle()})),!0)}}).init()
		}
		if(e("#plan-details").length>0){var R=e("#pg-helper-plan-id").text(),S=null,T=null;new f.Tab({name:"plan",switched:function(a,b,c){return c?!0:("reserve"==b&&(S=J("reserve",d.API.getPlanReserveRecords,{financePlanStr:R})),"joined"==b&&(S=J("joined",d.API.getPlanJoinedRecords,{financePlanStr:R})),"performance"==b&&new g.PlanPerformance({name:"performance",planId:R}).init(),!0)},clicked:function(a,b){T||"joined"==a&&b&&S&&S._update(S.getParams()),T=window.setTimeout(function(){window.clearTimeout(T),T=null},750)}}).init()}
		//提示信息
		//e("#tipCon").length&&e("#tips").length&&new b({element:"#tipCon",trigger:"#tips",direction:"right"}),
		//e("#tipCon_0").length&&e("#tips_0").length&&new b({element:"#tipCon_0",trigger:"#tips_0",direction:"right"}),
		//e("#tipCon_1").length&&e("#tips_1").length&&new b({element:"#tipCon_1",trigger:"#tips_1",direction:"right"}),
		//e("#tipCon_2").length&&e("#tips_2").length&&new b({element:"#tipCon_2",trigger:"#tips_2",direction:"down",arrowShift:-22})
	})
});